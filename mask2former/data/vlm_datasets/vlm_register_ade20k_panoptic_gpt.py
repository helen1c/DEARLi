# Copyright (c) Facebook, Inc. and its affiliates.
import json
import os

from .vlm_classes import get_ade20k_categories_with_prompt_eng

from detectron2.data import DatasetCatalog, MetadataCatalog
from detectron2.utils.file_io import PathManager

chatgpt_classes = {
    "ADE_val_00000001.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "5": "tree",
        "7": "road",
        "9": "window",
        "10": "grass",
        "14": "earth",
        "15": "door",
        "18": "plant",
        "26": "house exterior",
        "30": "field",
        "33": "fence",
        "35": "rock",
        "95": "land",
    },
    "ADE_val_00000002.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "5": "tree",
        "9": "window",
        "10": "grass",
        "14": "earth",
        "18": "plant",
        "33": "fence",
        "35": "rock",
        "85": "tower",
        "94": "pole",
        "95": "land",
    },
    "ADE_val_00000003.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "5": "tree",
        "7": "road",
        "9": "window",
        "12": "sidewalk",
        "18": "plant",
        "21": "car",
        "33": "fence",
        "39": "railing",
        "44": "sign",
        "54": "stairs",
        "60": "stairway",
        "62": "bridge",
        "81": "bus",
        "94": "pole",
        "103": "van",
    },
    "ADE_val_00000004.jpg": {
        "3": "sky",
        "5": "tree",
        "7": "road",
        "10": "grass",
        "13": "person",
        "14": "earth",
        "17": "mountain",
        "18": "plant",
        "21": "car",
        "30": "field",
        "55": "runway",
        "69": "hill",
        "91": "airplane",
        "95": "land",
    },
    "ADE_val_00000005.jpg": {
        "1": "wall",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "13": "person",
        "20": "chair",
        "32": "seat",
        "37": "lamp",
        "91": "airplane",
    },
    "ADE_val_00000006.jpg": {
        "2": "building",
        "3": "sky",
        "5": "tree",
        "7": "road",
        "10": "grass",
        "14": "earth",
        "33": "fence",
        "55": "runway",
        "91": "airplane",
        "94": "pole",
        "95": "land",
    },
    "ADE_val_00000007.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "13": "person",
        "37": "lamp",
        "39": "railing",
        "43": "column",
        "44": "sign",
    },
    "ADE_val_00000008.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "37": "lamp",
        "39": "railing",
        "43": "column",
    },
    "ADE_val_00000009.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "13": "person",
        "15": "door",
        "16": "table",
        "20": "chair",
        "32": "seat",
        "37": "lamp",
        "43": "column",
        "44": "sign",
        "46": "counter",
    },
    "ADE_val_00000010.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "13": "person",
        "18": "plant",
        "37": "lamp",
        "43": "column",
        "44": "sign",
    },
    "ADE_val_00000011.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "7": "road",
        "9": "window",
        "13": "person",
        "21": "car",
        "37": "lamp",
    },
    "ADE_val_00000012.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "13": "person",
        "15": "door",
        "37": "lamp",
        "44": "sign",
        "46": "counter",
        "90": "television receiver",
        "93": "apparel",
        "142": "crt screen",
    },
    "ADE_val_00000013.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "18": "plant",
        "19": "curtain",
        "23": "painting",
        "25": "shelf",
        "37": "lamp",
        "58": "pillow",
        "68": "book",
        "132": "blanket",
        "135": "sconce",
    },
    "ADE_val_00000014.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "5": "tree",
        "7": "road",
        "9": "window",
        "12": "sidewalk",
        "13": "person",
        "15": "door",
        "18": "plant",
        "37": "lamp",
        "39": "railing",
        "44": "sign",
    },
    "ADE_val_00000015.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "5": "tree",
        "9": "window",
        "12": "sidewalk",
        "18": "plant",
        "26": "house exterior",
        "33": "fence",
        "37": "lamp",
    },
    "ADE_val_00000016.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "7": "road",
        "9": "window",
        "13": "person",
        "15": "door",
        "18": "plant",
        "37": "lamp",
        "44": "sign",
        "88": "streetlight",
        "94": "pole",
    },
    "ADE_val_00000017.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "5": "tree",
        "15": "door",
        "18": "plant",
        "54": "stairs",
        "60": "stairway",
        "122": "step",
    },
    "ADE_val_00000018.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "5": "tree",
        "18": "plant",
        "39": "railing",
        "52": "grandstand",
        "53": "path",
        "54": "stairs",
        "60": "stairway",
        "102": "stage",
        "122": "step",
    },
    "ADE_val_00000019.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "13": "person",
        "20": "chair",
        "32": "seat",
        "37": "lamp",
        "79": "arcade machine",
        "90": "television receiver",
        "93": "apparel",
        "142": "crt screen",
    },
    "ADE_val_00000020.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "5": "tree",
        "18": "plant",
        "22": "water",
        "37": "lamp",
        "39": "railing",
        "44": "sign",
        "85": "tower",
        "94": "pole",
        "107": "canopy",
    },
    "ADE_val_00000021.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "5": "tree",
        "7": "road",
        "9": "window",
        "10": "grass",
        "12": "sidewalk",
        "14": "earth",
        "18": "plant",
        "33": "fence",
        "37": "lamp",
        "39": "railing",
        "44": "sign",
        "53": "path",
        "85": "tower",
        "88": "streetlight",
        "94": "pole",
        "109": "toy",
    },
    "ADE_val_00000022.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "5": "tree",
        "7": "road",
        "9": "window",
        "12": "sidewalk",
        "14": "earth",
        "18": "plant",
        "37": "lamp",
        "39": "railing",
        "44": "sign",
        "54": "stairs",
        "60": "stairway",
        "88": "streetlight",
        "122": "step",
    },
    "ADE_val_00000023.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "5": "tree",
        "7": "road",
        "9": "window",
        "12": "sidewalk",
        "18": "plant",
        "21": "car",
        "37": "lamp",
        "39": "railing",
        "44": "sign",
        "88": "streetlight",
        "94": "pole",
    },
    "ADE_val_00000024.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "9": "window",
        "35": "rock",
    },
    "ADE_val_00000025.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "16": "table",
        "18": "plant",
        "23": "painting",
        "37": "lamp",
        "39": "railing",
        "43": "column",
        "67": "flower",
        "133": "sculpture",
        "135": "sconce",
        "136": "vase",
    },
    "ADE_val_00000026.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "13": "person",
        "22": "water",
        "37": "lamp",
        "39": "railing",
        "127": "animal",
    },
    "ADE_val_00000027.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "5": "tree",
        "10": "grass",
        "14": "earth",
        "18": "plant",
        "30": "field",
        "35": "rock",
        "43": "column",
        "95": "land",
        "127": "animal",
    },
    "ADE_val_00000028.jpg": {"13": "person", "14": "earth", "35": "rock", "95": "land"},
    "ADE_val_00000029.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "13": "person",
        "25": "shelf",
        "32": "seat",
        "34": "desk",
        "37": "lamp",
        "63": "bookcase",
        "68": "book",
    },
    "ADE_val_00000030.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "10": "grass",
        "30": "field",
        "32": "seat",
        "37": "lamp",
        "39": "railing",
        "52": "grandstand",
        "54": "stairs",
        "60": "stairway",
        "122": "step",
    },
    "ADE_val_00000031.jpg": {
        "2": "building",
        "3": "sky",
        "7": "road",
        "10": "grass",
        "21": "car",
        "33": "fence",
        "55": "runway",
        "85": "tower",
        "91": "airplane",
        "94": "pole",
        "95": "land",
    },
    "ADE_val_00000032.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "7": "road",
        "21": "car",
        "33": "fence",
        "55": "runway",
        "91": "airplane",
        "94": "pole",
        "95": "land",
    },
    "ADE_val_00000033.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "23": "painting",
        "37": "lamp",
    },
    "ADE_val_00000034.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "13": "person",
        "23": "painting",
        "37": "lamp",
    },
    "ADE_val_00000035.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "23": "painting",
        "37": "lamp",
    },
    "ADE_val_00000036.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "13": "person",
        "16": "table",
        "23": "painting",
        "111": "stool",
    },
    "ADE_val_00000037.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "9": "window",
        "12": "sidewalk",
        "13": "person",
        "19": "curtain",
        "23": "painting",
        "33": "fence",
    },
    "ADE_val_00000038.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "16": "table",
        "20": "chair",
        "23": "painting",
        "25": "shelf",
        "37": "lamp",
        "76": "swivel chair",
    },
    "ADE_val_00000039.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "16": "table",
        "37": "lamp",
    },
    "ADE_val_00000040.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "5": "tree",
        "6": "ceiling",
        "9": "window",
        "20": "chair",
        "23": "painting",
        "45": "chest of drawers",
    },
    "ADE_val_00000041.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "15": "door",
        "43": "column",
        "147": "radiator",
    },
    "ADE_val_00000042.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "43": "column",
        "147": "radiator",
    },
    "ADE_val_00000043.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "10": "grass",
        "13": "person",
        "30": "field",
        "37": "lamp",
    },
    "ADE_val_00000044.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "15": "door",
        "16": "table",
        "18": "plant",
        "20": "chair",
        "32": "seat",
        "40": "cushion",
        "43": "column",
        "67": "flower",
        "133": "sculpture",
        "37": "lamp",
    },
    "ADE_val_00000045.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "15": "door",
        "19": "curtain",
        "28": "mirror",
        "29": "rug",
        "36": "wardrobe",
        "37": "lamp",
        "58": "pillow",
        "132": "blanket",
    },
    "ADE_val_00000046.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "15": "door",
        "37": "lamp",
        "39": "railing",
    },
    "ADE_val_00000047.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "20": "chair",
        "32": "seat",
        "37": "lamp",
        "111": "stool",
    },
    "ADE_val_00000048.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "35": "rock",
        "37": "lamp",
        "43": "column",
        "147": "radiator",
    },
    "ADE_val_00000049.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "23": "painting",
        "37": "lamp",
        "45": "chest of drawers",
        "58": "pillow",
        "132": "blanket",
        "135": "sconce",
    },
    "ADE_val_00000050.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "13": "person",
        "32": "seat",
        "37": "lamp",
        "39": "railing",
        "52": "grandstand",
        "54": "stairs",
        "60": "stairway",
        "102": "stage",
        "122": "step",
    },
    "ADE_val_00000051.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "13": "person",
        "21": "car",
        "37": "lamp",
        "39": "railing",
        "42": "box",
        "44": "sign",
        "106": "conveyer belt",
    },
    "ADE_val_00000052.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "5": "tree",
        "7": "road",
        "12": "sidewalk",
        "13": "person",
        "14": "earth",
        "18": "plant",
        "37": "lamp",
        "44": "signboard",
        "88": "streetlight",
        "94": "pole",
        "95": "land",
    },
    "ADE_val_00000053.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "13": "person",
        "21": "car",
        "37": "lamp",
        "44": "sign",
        "102": "stage",
        "124": "trade name",
    },
    "ADE_val_00000054.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "5": "tree",
        "14": "earth",
        "18": "plant",
        "35": "rock",
        "39": "railing",
        "54": "stairs",
        "60": "stairway",
        "122": "step",
        "95": "land",
    },
    "ADE_val_00000055.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "13": "person",
        "37": "lamp",
        "43": "column",
    },
    "ADE_val_00000056.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "37": "lamp",
        "44": "sign",
        "106": "conveyer belt",
        "142": "crt screen",
    },
    "ADE_val_00000057.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "13": "person",
        "37": "lamp",
        "44": "sign",
        "106": "conveyer belt",
        "116": "bag",
        "142": "crt screen",
    },
    "ADE_val_00000058.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "25": "shelf",
        "37": "lamp",
        "44": "sign",
        "46": "counter",
        "56": "display case",
        "121": "food",
    },
    "ADE_val_00000059.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "25": "shelf",
        "37": "lamp",
        "44": "sign",
        "46": "counter",
        "56": "display case",
        "121": "food",
    },
    "ADE_val_00000060.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "25": "shelf",
        "37": "lamp",
        "44": "sign",
        "46": "counter",
        "56": "display case",
        "121": "food",
    },
    "ADE_val_00000061.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "5": "tree",
        "6": "ceiling",
        "13": "person",
        "18": "plant",
        "20": "chair",
        "32": "seat",
        "37": "lamp",
        "39": "railing",
        "43": "column",
    },
    "ADE_val_00000062.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "5": "tree",
        "6": "ceiling",
        "9": "window",
        "18": "plant",
        "126": "plant pot",
    },
    "ADE_val_00000063.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "13": "person",
        "33": "fence",
        "37": "lamp",
        "109": "toy",
        "120": "ball",
    },
    "ADE_val_00000064.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "13": "person",
        "37": "lamp",
        "44": "sign",
        "102": "stage",
    },
    "ADE_val_00000065.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "15": "door",
        "16": "table",
        "18": "plant",
        "20": "chair",
        "32": "seat",
        "37": "lamp",
        "43": "column",
        "44": "sign",
        "46": "counter",
        "65": "coffee table",
        "71": "countertop",
    },
    "ADE_val_00000066.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "5": "tree",
        "18": "plant",
        "44": "signboard",
        "49": "skyscraper",
        "85": "tower",
        "94": "pole",
        "95": "land",
    },
    "ADE_val_00000067.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "23": "painting",
        "37": "lamp",
        "41": "pedestal",
        "43": "column",
        "135": "sconce",
    },
    "ADE_val_00000068.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "16": "table",
        "20": "chair",
        "23": "painting",
        "25": "shelf",
        "37": "lamp",
        "44": "sign",
        "46": "counter",
        "71": "countertop",
        "78": "bar",
        "99": "bottle",
    },
    "ADE_val_00000069.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "16": "table",
        "20": "chair",
        "37": "lamp",
        "44": "sign",
        "71": "countertop",
        "78": "bar",
        "111": "stool",
    },
    "ADE_val_00000070.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "13": "person",
        "37": "lamp",
        "44": "sign",
        "46": "counter",
        "78": "bar",
        "99": "bottle",
        "148": "cup",
    },
    "ADE_val_00000071.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "16": "table",
        "20": "chair",
        "28": "mirror",
        "37": "lamp",
        "45": "chest of drawers",
        "71": "countertop",
        "76": "swivel chair",
        "135": "sconce",
    },
    "ADE_val_00000072.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "10": "grass",
        "13": "person",
        "14": "earth",
        "15": "door",
        "18": "plant",
        "35": "rock",
    },
    "ADE_val_00000073.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "5": "tree",
        "10": "grass",
        "14": "earth",
        "30": "field",
        "33": "fence",
        "37": "lamp",
        "70": "bench",
        "94": "pole",
        "95": "land",
    },
    "ADE_val_00000074.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "15": "door",
        "23": "painting",
        "37": "lamp",
        "44": "sign",
    },
    "ADE_val_00000075.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "37": "lamp",
        "43": "column",
        "44": "sign",
        "70": "bench",
        "94": "pole",
    },
    "ADE_val_00000085.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "18": "plant",
        "28": "mirror",
        "38": "bathtub",
        "48": "sink",
        "66": "toilet",
        "67": "flower",
        "136": "vase",
        "37": "lamp",
    },
    "ADE_val_00000084.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "18": "plant",
        "23": "painting",
        "24": "sofa",
        "38": "bathtub",
        "48": "sink",
        "58": "pillow",
        "66": "toilet",
        "67": "flower",
        "132": "blanket",
        "19": "curtain",
        "45": "chest of drawers",
        "15": "door",
    },
    "ADE_val_00000083.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "28": "mirror",
        "48": "sink",
        "66": "toilet",
    },
    "ADE_val_00000082.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "25": "shelf",
        "28": "mirror",
        "38": "bathtub",
        "48": "sink",
        "9": "window",
    },
    "ADE_val_00000081.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "15": "door",
        "28": "mirror",
        "46": "counter",
        "48": "sink",
        "66": "toilet",
        "146": "shower",
        "37": "lamp",
    },
    "ADE_val_00000080.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "19": "curtain",
        "45": "chest of drawers",
        "146": "shower",
    },
    "ADE_val_00000079.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "15": "door",
        "25": "shelf",
        "28": "mirror",
        "37": "lamp",
        "38": "bathtub",
        "48": "sink",
        "146": "shower",
    },
    "ADE_val_00000078.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "15": "door",
        "28": "mirror",
        "48": "sink",
        "66": "toilet",
        "38": "bathtub",
        "146": "shower",
        "82": "towel",
    },
    "ADE_val_00000077.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "28": "mirror",
        "48": "sink",
        "71": "countertop",
        "82": "towel",
        "148": "cup",
    },
    "ADE_val_00000076.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "22": "water",
        "37": "lamp",
        "43": "column",
        "110": "swimming pool",
        "133": "sculpture",
    },
    "ADE_val_00000086.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "19": "curtain",
        "31": "armchair",
        "38": "bathtub",
        "40": "cushion",
        "28": "mirror",
        "23": "painting",
        "37": "lamp",
        "50": "fireplace",
    },
    "ADE_val_00000087.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "37": "lamp",
        "42": "box",
        "46": "counter",
        "48": "sink",
        "66": "toilet",
        "71": "countertop",
        "82": "towel",
        "99": "bottle",
        "127": "animal",
        "139": "trash can",
    },
    "ADE_val_00000088.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "28": "mirror",
        "37": "lamp",
        "42": "box",
        "48": "sink",
        "71": "countertop",
        "99": "bottle",
        "146": "shower",
    },
    "ADE_val_00000089.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "18": "plant",
        "23": "painting",
        "29": "rug",
        "37": "lamp",
        "38": "bathtub",
        "48": "sink",
        "66": "toilet",
        "71": "countertop",
        "82": "towel",
        "99": "bottle",
        "126": "plant pots",
        "139": "trash can",
        "146": "shower",
    },
    "ADE_val_00000090.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "15": "door",
        "19": "curtain",
        "29": "rug",
        "37": "lamp",
        "48": "sink",
        "66": "toilet",
        "71": "countertop",
        "82": "towel",
        "146": "shower",
        "147": "radiator",
    },
    "ADE_val_00000091.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "28": "mirror",
        "42": "box",
        "48": "sink",
        "66": "toilet",
        "139": "trash can",
    },
    "ADE_val_00000092.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "11": "cabinet",
        "28": "mirror",
        "37": "lamp",
        "46": "counter",
        "48": "sink",
        "66": "toilet",
        "71": "countertop",
        "82": "towel",
        "135": "sconce",
    },
    "ADE_val_00000093.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "19": "curtain",
        "29": "rug",
        "38": "bathtub",
        "48": "sink",
        "66": "toilet",
        "146": "shower",
    },
    "ADE_val_00000094.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "28": "mirror",
        "42": "box",
        "46": "counter",
        "48": "sink",
        "71": "countertop",
        "82": "towel",
        "146": "shower",
    },
    "ADE_val_00000095.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "15": "door",
        "28": "mirror",
        "37": "lamp",
        "48": "sink",
        "66": "toilet",
        "135": "sconce",
    },
    "ADE_val_00000096.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "66": "toilet",
    },
    "ADE_val_00000097.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "19": "curtain",
        "23": "painting",
        "28": "mirror",
        "29": "rug",
        "37": "lamp",
        "46": "counter",
        "48": "sink",
        "66": "toilet",
        "67": "flower",
        "71": "countertop",
        "82": "towel",
        "135": "sconce",
        "136": "vase",
    },
    "ADE_val_00000098.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "28": "mirror",
        "38": "bathtub",
        "46": "counter",
        "48": "sink",
        "82": "towel",
        "99": "bottle",
    },
    "ADE_val_00000099.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "19": "curtain",
        "29": "rug",
        "38": "bathtub",
        "48": "sink",
        "66": "toilet",
    },
    "ADE_val_00000100.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "11": "cabinet",
        "28": "mirror",
        "37": "lamp",
        "48": "sink",
        "135": "sconce",
        "139": "trash can",
        "36": "wardrobe",
    },
    "ADE_val_00000101.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "15": "door",
        "38": "bathtub",
        "66": "toilet",
        "147": "radiator",
    },
    "ADE_val_00000102.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "11": "cabinet",
        "28": "mirror",
        "37": "lamp",
        "48": "sink",
        "66": "toilet",
        "71": "countertop",
        "146": "shower",
    },
    "ADE_val_00000103.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "28": "mirror",
        "29": "rug",
        "38": "bathtub",
        "48": "sink",
        "66": "toilet",
        "82": "towel",
        "18": "plant",
        "139": "trash can",
    },
    "ADE_val_00000104.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "15": "door",
        "28": "mirror",
        "37": "lamp",
        "48": "sink",
        "71": "countertop",
        "11": "cabinet",
        "135": "sconce",
    },
    "ADE_val_00000105.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "11": "cabinet",
        "18": "plant",
        "28": "mirror",
        "48": "sink",
        "66": "toilet",
        "71": "countertop",
        "82": "towel",
        "136": "vase",
    },
    "ADE_val_00000106.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "19": "curtain",
        "29": "rug",
        "38": "bathtub",
        "48": "sink",
        "66": "toilet",
        "37": "lamp",
        "16": "table",
    },
    "ADE_val_00000107.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "28": "mirror",
        "38": "bathtub",
        "48": "sink",
        "71": "countertop",
        "82": "towel",
        "98": "ottoman",
        "16": "table",
        "37": "lamp",
    },
    "ADE_val_00000108.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "19": "curtain",
        "82": "towel",
        "146": "shower",
    },
    "ADE_val_00000109.jpg": {
        "10": "grass",
        "13": "person",
        "14": "earth",
        "30": "field",
        "95": "land",
    },
    "ADE_val_00000110.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "5": "tree",
        "18": "plant",
        "35": "rock",
        "39": "railing",
        "53": "path",
        "13": "person",
    },
    "ADE_val_00000111.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "5": "tree",
        "12": "sidewalk",
        "13": "person",
        "18": "plant",
        "37": "lamp",
        "42": "box",
        "44": "sign",
        "46": "counter",
        "53": "path",
        "71": "countertop",
        "95": "land",
        "121": "food",
    },
    "ADE_val_00000112.jpg": {
        "2": "building",
        "3": "sky",
        "5": "tree",
        "14": "earth",
        "22": "water",
        "27": "sea",
        "35": "rock",
        "47": "sand",
        "95": "land",
    },
    "ADE_val_00000113.jpg": {
        "2": "building",
        "3": "sky",
        "5": "tree",
        "14": "earth",
        "22": "water",
        "27": "sea",
        "35": "rock",
        "47": "sand",
        "95": "land",
    },
    "ADE_val_00000114.jpg": {
        "3": "sky",
        "5": "tree",
        "14": "earth",
        "22": "water",
        "27": "sea",
        "35": "rock",
        "47": "sand",
        "95": "land",
    },
    "ADE_val_00000115.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "11": "cabinet",
        "25": "shelf",
        "28": "mirror",
        "37": "lamp",
        "48": "sink",
        "71": "countertop",
        "99": "bottle",
    },
    "ADE_val_00000116.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "13": "person",
        "20": "chair",
        "37": "lamp",
        "44": "sign",
        "71": "countertop",
        "76": "swivel chair",
        "82": "towel",
        "99": "bottle",
    },
    "ADE_val_00000117.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "9": "window",
        "15": "door",
        "18": "plant",
        "20": "chair",
        "40": "cushion",
        "45": "chest of drawers",
    },
    "ADE_val_00000118.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "11": "cabinet",
        "16": "table",
        "29": "rug",
        "37": "lamp",
        "58": "pillow",
        "75": "computer",
        "90": "television receiver",
    },
    "ADE_val_00000119.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "18": "plant",
        "19": "curtain",
        "28": "mirror",
        "36": "wardrobe",
        "40": "cushion",
        "58": "pillow",
    },
    "ADE_val_00000120.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "16": "table",
        "23": "painting",
        "28": "mirror",
        "37": "lamp",
        "45": "chest of drawers",
        "58": "pillow",
        "90": "television receiver",
        "132": "blanket",
    },
    "ADE_val_00000121.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "15": "door",
        "16": "table",
        "18": "plant",
        "19": "curtain",
        "23": "painting",
        "37": "lamp",
        "40": "cushion",
        "45": "chest of drawers",
        "58": "pillow",
        "126": "plant pots",
        "132": "blanket",
    },
    "ADE_val_00000122.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "16": "table",
        "19": "curtain",
        "58": "pillow",
        "132": "blanket",
        "148": "cup",
    },
    "ADE_val_00000123.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "19": "curtain",
        "20": "chair",
        "34": "desk",
        "37": "lamp",
        "58": "pillow",
        "63": "bookcase",
        "68": "book",
        "132": "blanket",
    },
    "ADE_val_00000124.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "16": "table",
        "37": "lamp",
        "58": "pillow",
        "132": "blanket",
    },
    "ADE_val_00000125.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "15": "door",
        "16": "table",
        "20": "chair",
        "23": "painting",
        "37": "lamp",
        "58": "pillow",
        "132": "blanket",
    },
    "ADE_val_00000126.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "16": "table",
        "19": "curtain",
        "28": "mirror",
        "37": "lamp",
        "40": "cushion",
        "58": "pillow",
        "99": "bottle",
        "132": "blanket",
    },
    "ADE_val_00000127.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "15": "door",
        "16": "table",
        "20": "chair",
        "23": "painting",
        "37": "lamp",
        "40": "cushion",
        "45": "chest of drawers",
        "58": "pillow",
        "132": "blanket",
        "140": "ceiling fan",
    },
    "ADE_val_00000128.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "15": "door",
        "20": "chair",
        "34": "desk",
        "58": "pillow",
        "147": "radiator",
    },
    "ADE_val_00000129.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "16": "table",
        "19": "curtain",
        "23": "painting",
        "28": "mirror",
        "37": "lamp",
        "40": "cushion",
        "58": "pillow",
        "132": "blanket",
        "140": "ceiling fan",
    },
    "ADE_val_00000130.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "16": "table",
        "18": "plant",
        "20": "chair",
        "23": "painting",
        "37": "lamp",
        "58": "pillow",
        "63": "bookcase",
        "113": "basket",
        "126": "plant pots",
        "127": "animal",
        "132": "blanket",
    },
    "ADE_val_00000131.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "16": "table",
        "19": "curtain",
        "23": "painting",
        "37": "lamp",
        "40": "cushion",
        "58": "pillow",
        "132": "blanket",
    },
    "ADE_val_00000132.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "5": "tree",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "10": "grass",
        "15": "door",
        "16": "table",
        "18": "plant",
        "19": "curtain",
        "20": "chair",
        "23": "painting",
        "35": "rock",
        "37": "lamp",
        "40": "cushion",
        "58": "pillow",
        "70": "bench",
        "132": "blanket",
    },
    "ADE_val_00000133.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "16": "table",
        "23": "painting",
        "37": "lamp",
        "58": "pillow",
        "132": "blanket",
    },
    "ADE_val_00000134.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "5": "tree",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "16": "table",
        "18": "plant",
        "19": "curtain",
        "23": "painting",
        "28": "mirror",
        "37": "lamp",
        "45": "chest of drawers",
        "58": "pillow",
        "67": "flower",
        "132": "blanket",
    },
    "ADE_val_00000135.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "5": "tree",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "10": "grass",
        "16": "table",
        "18": "plant",
        "19": "curtain",
        "20": "chair",
        "23": "painting",
        "29": "rug",
        "37": "lamp",
        "40": "cushion",
        "58": "pillow",
        "67": "flower",
        "132": "blanket",
        "140": "ceiling fan",
    },
    "ADE_val_00000136.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "19": "curtain",
        "20": "chair",
        "37": "lamp",
        "48": "sink",
        "58": "pillow",
        "71": "countertop",
        "132": "blanket",
    },
    "ADE_val_00000137.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "16": "table",
        "18": "plant",
        "20": "chair",
        "23": "painting",
        "24": "sofa",
        "37": "lamp",
        "40": "cushion",
        "58": "pillow",
        "65": "coffee table",
        "75": "computer",
        "132": "blanket",
    },
    "ADE_val_00000138.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "5": "tree",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "10": "grass",
        "15": "door",
        "16": "table",
        "18": "plant",
        "19": "curtain",
        "20": "chair",
        "23": "painting",
        "29": "rug",
        "37": "lamp",
        "40": "cushion",
        "58": "pillow",
        "132": "blanket",
    },
    "ADE_val_00000139.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "5": "tree",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "10": "grass",
        "15": "door",
        "16": "table",
        "18": "plant",
        "19": "curtain",
        "20": "chair",
        "23": "painting",
        "29": "rug",
        "37": "lamp",
        "40": "cushion",
        "58": "pillow",
        "67": "flower",
        "132": "blanket",
        "140": "ceiling fan",
    },
    "ADE_val_00000140.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "15": "door",
        "28": "mirror",
        "37": "lamp",
        "45": "chest of drawers",
        "48": "sink",
        "58": "pillow",
        "71": "countertop",
        "90": "television receiver",
        "132": "blanket",
    },
    "ADE_val_00000141.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "16": "table",
        "19": "curtain",
        "37": "lamp",
        "40": "cushion",
        "45": "chest of drawers",
        "58": "pillow",
        "132": "blanket",
        "36": "wardrobe",
    },
    "ADE_val_00000142.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "16": "table",
        "19": "curtain",
        "23": "painting",
        "37": "lamp",
        "58": "pillow",
        "132": "blanket",
    },
    "ADE_val_00000143.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "16": "table",
        "18": "plant",
        "23": "painting",
        "37": "lamp",
        "40": "cushion",
        "58": "pillow",
        "65": "coffee table",
        "70": "bench",
        "90": "television receiver",
        "132": "blanket",
    },
    "ADE_val_00000144.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "15": "door",
        "16": "table",
        "19": "curtain",
        "20": "chair",
        "23": "painting",
        "37": "lamp",
        "40": "cushion",
        "45": "chest of drawers",
        "58": "pillow",
        "132": "blanket",
        "140": "ceiling fan",
    },
    "ADE_val_00000145.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "16": "table",
        "18": "plant",
        "37": "lamp",
        "58": "pillow",
        "132": "blanket",
    },
    "ADE_val_00000146.jpg": {
        "1": "wall",
        "2": "building",
        "3": "sky",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "10": "grass",
        "16": "table",
        "18": "plant",
        "20": "chair",
        "23": "painting",
        "37": "lamp",
        "40": "cushion",
        "58": "pillow",
        "67": "flower",
        "70": "bench",
        "132": "blanket",
    },
    "ADE_val_00000147.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "16": "table",
        "18": "plant",
        "20": "chair",
        "23": "painting",
        "37": "lamp",
        "58": "pillow",
        "132": "blanket",
    },
    "ADE_val_00000148.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "16": "table",
        "37": "lamp",
        "45": "chest of drawers",
        "58": "pillow",
        "132": "blanket",
        "36": "wardrobe",
    },
    "ADE_val_00000149.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "16": "table",
        "37": "lamp",
        "58": "pillow",
        "132": "blanket",
    },
    "ADE_val_00000150.jpg": {
        "1": "wall",
        "2": "building",
        "4": "floor",
        "6": "ceiling",
        "8": "bed",
        "9": "window",
        "16": "table",
        "23": "painting",
        "37": "lamp",
        "58": "pillow",
        "132": "blanket",
    },
}
# remove .jpg in each key in chatgpt classes dictionary
for key in list(chatgpt_classes.keys()):
    new_key = key.replace(".jpg", "")
    chatgpt_classes[new_key] = chatgpt_classes.pop(key)


ADE20K_150_CATEGORIES = get_ade20k_categories_with_prompt_eng()
ADE20K_COLORS = [k["color"] for k in ADE20K_150_CATEGORIES]

MetadataCatalog.get("ade20k_sem_seg_train").set(
    stuff_colors=ADE20K_COLORS[:],
)

MetadataCatalog.get("ade20k_sem_seg_val").set(
    stuff_colors=ADE20K_COLORS[:],
)


def load_ade20k_panoptic_json(json_file, image_dir, gt_dir, semseg_dir, meta):
    """
    Args:
        image_dir (str): path to the raw dataset. e.g., "~/coco/train2017".
        gt_dir (str): path to the raw annotations. e.g., "~/coco/panoptic_train2017".
        json_file (str): path to the json file. e.g., "~/coco/annotations/panoptic_train2017.json".
    Returns:
        list[dict]: a list of dicts in Detectron2 standard format. (See
        `Using Custom Datasets </tutorials/datasets.html>`_ )
    """

    def _convert_category_id(segment_info, meta):
        if segment_info["category_id"] in meta["thing_dataset_id_to_contiguous_id"]:
            segment_info["category_id"] = meta["thing_dataset_id_to_contiguous_id"][
                segment_info["category_id"]
            ]
            segment_info["isthing"] = True
        else:
            segment_info["category_id"] = meta["stuff_dataset_id_to_contiguous_id"][
                segment_info["category_id"]
            ]
            segment_info["isthing"] = False
        return segment_info

    with PathManager.open(json_file) as f:
        json_info = json.load(f)

    ret = []
    for ann in json_info["annotations"]:
        image_id = ann["image_id"]
        if image_id not in chatgpt_classes:
            continue
        # TODO: currently we assume image and label has the same filename but
        # different extension, and images have extension ".jpg" for COCO. Need
        # to make image extension a user-provided argument if we extend this
        # function to support other COCO-like datasets.
        image_file = os.path.join(
            image_dir, os.path.splitext(ann["file_name"])[0] + ".jpg"
        )
        label_file = os.path.join(gt_dir, ann["file_name"])
        sem_label_file = os.path.join(semseg_dir, ann["file_name"])
        segments_info = [_convert_category_id(x, meta) for x in ann["segments_info"]]
        ret.append(
            {
                "file_name": image_file,
                "image_id": image_id,
                "pan_seg_file_name": label_file,
                "sem_seg_file_name": sem_label_file,
                "segments_info": segments_info,
            }
        )
    assert len(ret), f"No images found in {image_dir}!"
    assert PathManager.isfile(ret[0]["file_name"]), ret[0]["file_name"]
    assert PathManager.isfile(ret[0]["pan_seg_file_name"]), ret[0]["pan_seg_file_name"]
    assert PathManager.isfile(ret[0]["sem_seg_file_name"]), ret[0]["sem_seg_file_name"]
    return ret


def register_ade20k_panoptic(
    name,
    metadata,
    image_root,
    panoptic_root,
    semantic_root,
    panoptic_json,
    instances_json=None,
):
    """
    Register a "standard" version of ADE20k panoptic segmentation dataset named `name`.
    The dictionaries in this registered dataset follows detectron2's standard format.
    Hence it's called "standard".
    Args:
        name (str): the name that identifies a dataset,
            e.g. "ade20k_panoptic_train"
        metadata (dict): extra metadata associated with this dataset.
        image_root (str): directory which contains all the images
        panoptic_root (str): directory which contains panoptic annotation images in COCO format
        panoptic_json (str): path to the json panoptic annotation file in COCO format
        sem_seg_root (none): not used, to be consistent with
            `register_coco_panoptic_separated`.
        instances_json (str): path to the json instance annotation file
    """
    panoptic_name = name
    DatasetCatalog.register(
        panoptic_name,
        lambda: load_ade20k_panoptic_json(
            panoptic_json, image_root, panoptic_root, semantic_root, metadata
        ),
    )
    MetadataCatalog.get(panoptic_name).set(
        panoptic_root=panoptic_root,
        image_root=image_root,
        panoptic_json=panoptic_json,
        json_file=instances_json,
        evaluator_type="ade20k_panoptic_seg",
        ignore_label=255,
        label_divisor=1000,
        **metadata,
    )


_PREDEFINED_SPLITS_ADE20K_PANOPTIC = {
    "vlm_ade20k_panoptic_val_gpt": (
        "ADEChallengeData2016/images/validation",
        "ADEChallengeData2016/ade20k_panoptic_val",
        "ADEChallengeData2016/ade20k_panoptic_val_150.json",
        "ADEChallengeData2016/annotations_detectron2/validation",
        "ADEChallengeData2016/ade20k_instance_val.json",
    ),
}


def get_metadata():
    meta = {}
    # The following metadata maps contiguous id from [0, #thing categories +
    # #stuff categories) to their names and colors. We have to replica of the
    # same name and color under "thing_*" and "stuff_*" because the current
    # visualization function in D2 handles thing and class classes differently
    # due to some heuristic used in Panoptic FPN. We keep the same naming to
    # enable reusing existing visualization functions.
    thing_classes = [k["name"] for k in ADE20K_150_CATEGORIES if k["isthing"] == 1]
    thing_colors = [k["color"] for k in ADE20K_150_CATEGORIES if k["isthing"] == 1]
    stuff_classes = [k["name"] for k in ADE20K_150_CATEGORIES]
    stuff_colors = [k["color"] for k in ADE20K_150_CATEGORIES]

    meta["thing_classes"] = thing_classes
    meta["thing_colors"] = thing_colors
    meta["stuff_classes"] = stuff_classes
    meta["stuff_colors"] = stuff_colors

    # Convert category id for training:
    #   category id: like semantic segmentation, it is the class id for each
    #   pixel. Since there are some classes not used in evaluation, the category
    #   id is not always contiguous and thus we have two set of category ids:
    #       - original category id: category id in the original dataset, mainly
    #           used for evaluation.
    #       - contiguous category id: [0, #classes), in order to train the linear
    #           softmax classifier.
    thing_dataset_id_to_contiguous_id = {}
    stuff_dataset_id_to_contiguous_id = {}

    for i, cat in enumerate(ADE20K_150_CATEGORIES):
        if cat["isthing"]:
            thing_dataset_id_to_contiguous_id[cat["id"]] = i
        # else:
        #     stuff_dataset_id_to_contiguous_id[cat["id"]] = i

        # in order to use sem_seg evaluator
        stuff_dataset_id_to_contiguous_id[cat["id"]] = i

    meta["thing_dataset_id_to_contiguous_id"] = thing_dataset_id_to_contiguous_id
    meta["stuff_dataset_id_to_contiguous_id"] = stuff_dataset_id_to_contiguous_id

    return meta


def register_vlm_all_ade20k_panoptic(root):
    metadata = get_metadata()
    for (
        prefix,
        (image_root, panoptic_root, panoptic_json, semantic_root, instance_json),
    ) in _PREDEFINED_SPLITS_ADE20K_PANOPTIC.items():
        # The "standard" version of COCO panoptic segmentation dataset,
        # e.g. used by Panoptic-DeepLab
        register_ade20k_panoptic(
            prefix,
            metadata,
            os.path.join(root, image_root),
            os.path.join(root, panoptic_root),
            os.path.join(root, semantic_root),
            os.path.join(root, panoptic_json),
            os.path.join(root, instance_json),
        )


_root = os.getenv("DETECTRON2_DATASETS", "datasets")
register_vlm_all_ade20k_panoptic(_root)
